
# Automation info and set up


```
## Warning in readLines(dest_file): incomplete final line found on 'resources/
## other_chapters/How-to-set-up-and-customize-GitHub-actions-robots.md'
```


<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Customizing Automation](#customizing-automation)
  - [Pull request checks:](#pull-request-checks)
    - [Check quiz formatting](#check-quiz-formatting)
    - [Check for broken URLs](#check-for-broken-urls)
    - [Preview rendering](#preview-rendering)
    - [Spell checking](#spell-checking)
    - [Style code](#style-code)
    - [Docker testing](#docker-testing)
  - [Rendering actions](#rendering-actions)
  - [Manually re-running rendering or checks](#manually-running-rendering-or-checks)
  - [Fixing broken GitHub actions](#fixing-broken-github-actions)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Customizing Automation

By default, all automation steps and checks will run. But depending on the needs of your course, you can turn these on and off by going to the `config_automation.yml` file and switching options to `yes` or `no`. 

The `config_automation.yml` file looks like this:

```
# Formatting Checks (run at pull request)
check-quizzes: yes
url-checker: yes
render-preview: yes
style-and-sp-check: yes
...
```

There are two main sets of automation steps and checks run:
- `.github/workflows/pull-request.yml` : run upon opening a pull request
- `.github/workflows/render-all.yml`: run upon changes being merged to the `main` branch 

## Pull request checks: 

These actions are triggered upon a pull request being opened. It's set up is in the file: `.github/workflows/pull-request.yml`/.

### Check quiz formatting
In the `config_automation.yml` file it is set by:
```
check-quizzes: no
```
By default, it is set to `no`. But if you wish to [create quizzes on Leanpub](https://github.com/jhudsl/OTTR_Template/wiki/Publishing-on-Leanpub), you should set this to `yes`. This is not necessary if you only want quizzes for Coursera. 
Leanpub needs a particular format for it to upload correctly. This action will look for quizzes in a `quizzes` directory and check for these items. The outcome of these quiz checks will be printed to a GitHub comment on your pull request. 

### Check for broken URLs
In the `config_automation.yml` file it is set by:
```
url-checker: yes
```

GitHub actions runs a check on all the URLs upon creating a pull request to the `main` branch.
If it fails, you'll need to go the `Actions` tab of this repository, then find the GitHub `check_urls` job for the last commit you just pushed.
Click on `check_urls` and the specific step of `Check URLs` to see a print out of the URLs tested.

If the URL checker is failing on something that isn't really a URL or doesn't need to be checked, open up the `pull-request.yml`, scroll down to the `url-check` step and add the imposter URL on to the `exclude-urls:` argument with a comma in between.

### Preview rendering
In the `config_automation.yml` file it is set by:
```
render-preview: yes
```
After you open a pull request, a preview of the renders will be linked in a automatic comment on the pull request. Upon each commit these previews will re-render and edit the comment with the latest render. 

![](https://raw.githubusercontent.com/jhudsl/OTTR_Template/main/resources/screenshots/preview_comment.png)

These Github Actions are located in `render-preview` section of the `pull-request.yml`.
These previews do NOT incorporate any changes influenced by any changes to the Docker image if the Dockerfile is also updated in the same pull request.


### Spell checking
In the `config_automation.yml` file it is set by:
```
spell-check: yes
```
Github actions will automatically [run a spell check on all Rmd's and md's](https://github.com/jhudsl/OTTR_Template/blob/main/.github/workflows/style-and-sp-check.yml) whenever a pull request to the `main` branch is filed.

It will fail if there are more than 2 spelling errors and you'll need to resolve those before being able to merge your pull request. Errors will be printed out on a GitHub comment on your pull request. 

![](https://raw.githubusercontent.com/jhudsl/OTTR_Template/main/resources/screenshots/spell_check_comment.png)

To resolve those spelling errors, click on the link with the errors on the autogenerated comment. 
Some of these errors may be things that the spell check doesn't recognize for example: `ITCR` or `DaSL`.
If it's a 'word' the spell check should recognize, you'll need to add this to the dictionary.

Go to the `resources/dictionary.txt` file.
Open the file and add the new 'word' to its appropriate place (the words are in alphabetical order).
Then commit the changes to `resources/dictionary.txt` to your branch and this should make the spell check status check pass.

### Style code 
In the config_automation.yml file it is set by:
```
style-code: yes
```
The `styler` package to all style R in all Rmds.
Style changes will automatically be committed back to your branch.

### Docker testing
In the config_automation.yml file it looks like:
```
docker-test: no
```
By default it is set to `no` which means it won't run automatically unless you change this to `yes`. 
This is only relevant if you have [your own Docker image you are managing for your course](https://github.com/jhudsl/OTTR_Template/wiki/Using-Docker#starting-a-new-docker-image). If changes are made to Docker-relevant files: `Dockerfile`, `install_github.R`, or `github_package_list.tsv`, this will test re-build the Docker image. If it is successfully built, then it makes sense to merge it to `main` but the docker image will not be pushed to `Dockerhub` automatically. [Follow these instructions to push your Docker image to Dockerhub](https://github.com/jhudsl/OTTR_Template/wiki/Using-Docker#pushing-the-docker-image). 

## Rendering actions

Upon merging changes to any `Rmd` or `assets/` folder to `main`, the course material will be automatically re-rendered. 
By default, all rendering steps will be run. But depending on the needs of your course, you can turn these on and off by going to the `config_automation.yml` file and switching options to `yes` or `no`. 

```
render-bookdown: yes
render-leanpub: yes
render-coursera: yes
```
For publishing to Leanpub, make sure that the render Leanpub option is set to yes: `render-leanpub: yes`.  [See more details about publishing to Leanpub, here](https://github.com/jhudsl/OTTR_Template/wiki/Publishing-on-Leanpub). 

For publishing to Coursera, make sure render Coursera option is set to yes: `render-coursera: yes`. [See more details about publishing to Coursera, here](https://github.com/jhudsl/OTTR_Template/wiki/Publishing-on-Coursera). 

## Manually running rendering or checks 

From time to time, it may be useful to manually re-trigger a particular GitHub action. Most of the GitHub Actions, particularly the rendering ones, can be re-run manually. See this article about [how to manually re-run a GitHub Action](https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow#running-a-workflow). 

## Fixing broken GitHub Actions

GitHub action rendering or other GitHub actions may fail sometimes if the input is unexpected or for a number of other reasons. 
To investigate why a GitHub action has failed, go to `Actions` and click on the failed action. [See this article for how to find this information](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#viewing-the-workflows-activity).

If you are unsure what the error message means and have trouble addressing it, please [file an issue on the OTTR_Template repository to get help](https://github.com/jhudsl/OTTR_Template/issues/new?assignees=cansavvy&labels=bug&template=course-template-problem-report.md).


<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [How to enroll a repository to receive template updates](#how-to-enroll-a-repository-to-receive-template-updates)
- [How to tailor incoming sync changes:](#how-to-tailor-incoming-sync-changes)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->


This original course template: https://github.com/jhudsl/OTTR_Template is always a work in progress.
We are working on adding more features and smoothing out bugs as we go (this is also why [your feedback is greatly appreciated](https://github.com/jhudsl/OTTR_Template/issues/new/choose)).

When updates are made to files that aren't specific to the course content but instead run checks and other processes in the original repository, pull requests are filed automatically to any downstream repositories made from this template.

### How to enroll a repository to receive template updates

**To enroll in these automatic update PRs, the new course's repository name will need to be added to [this file in the original template](https://github.com/jhudsl/OTTR_Template/edit/main/.github/sync.yml)**

- Use [this link to edit the file](https://github.com/jhudsl/OTTR_Template/edit/main/.github/sync.yml).
- Add your repository's name where it says `#NEW REPO HERE#`, being careful to indent the same amount as the other repositories listed.
![](https://raw.githubusercontent.com/jhudsl/OTTR_Template/main/resources/screenshots/edit-sync.yml.png)
- Choose `Create a new branch for this commit and start a pull request.` Name the branch what you like.
![](https://raw.githubusercontent.com/jhudsl/OTTR_Template/main/resources/screenshots/add-repo-sync.png)
- Name the commit `Add new repository to sync`
- Click `Propose changes`.
- Write a short pull request description describing that you are adding a new repository to the sync.yml file.
- Click `Create Pull Request`
- Request `@cansavvy` as a reviewer.

If the your new course doesn't need some of the functionality of these files or you find the automatic bothersome, you can feel free to use [this guide](https://github.com/marketplace/actions/repo-file-sync-action#sync-the-same-files-to-multiple-repositories) to tailor which files you want updates for.
_If you have any questions about the implications of any of these updates or files, please tag `@cansavvy`._

### How to tailor incoming sync changes:  

Upon a new release, a pull request is automatically filed to any repositories that are added to the [sync.yml file](https://github.com/jhudsl/OTTR_Template/blob/main/.github/sync.yml).
**Carefully review the latest [release notes](https://github.com/jhudsl/OTTR_Template/wiki/Release-Notes) and the `Files changed` tab of the sync PR.** And again, tag `@cansavvy` with any questions.  

It might be that you want some of the changes from the PR but not all of them.
Each file that is updated in a sync PR is updated in its own commit.

- If you don't want the changes from a particular file, you can always [revert that particular commit](https://git-scm.com/docs/git-revert) before merging the sync PR.    
If you will not want any updates on this file in the future, you may want to remove a file from being synced in your repo [by reconfiguring the sync file](https://github.com/jhudsl/OTTR_Template/blob/main/.github/sync.yml).

- If you want only some changes, but they are not on a whole file basis, you could check out the branch and make manual edits.
To checkout the branch, navigate to your own repository you should be able to run:  
```
git checkout repo-sync/OTTR_Template/default
```

- If you don't want any of the changes you can close the PR entirely.
You may want to unenroll your repository from the [sync github actions by deleting your repo name from this file](https://github.com/jhudsl/OTTR_Template/blob/main/.github/sync.yml) if this will continue to be the case.
